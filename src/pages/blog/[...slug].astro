---
import client from "tina-client";
import { TinaMarkdown } from "tinacms/dist/rich-text";
import MainLayout from "../../layouts/MainLayout.astro";

export async function getStaticPaths() {
  const { data } = await client.queries.postConnection();
  const paths = data.postConnection.edges.map((edge) => ({
    params: { slug: edge.node._sys.filename },
  }));

  return paths;
}

const { slug } = Astro.params;
const { data, query, variables } = await client.queries.post({
  relativePath: `${slug}.md`,
});
---

<MainLayout title={data.post.title} description={data.post.excerpt}>
  <!-- Blog Post Hero -->
  <section class="blog-post-hero py-5 py-lg-11 py-xl-12 bg-light-gray">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-xl-8 col-xxl-7">
          <div class="d-flex flex-column gap-6" data-aos="fade-up" data-aos-delay="100" data-aos-duration="1000">
            <div class="d-flex align-items-center gap-3">
              <span class="badge text-bg-primary">{data.post.category}</span>
              <span class="text-opacity-70">{new Date(data.post.publishDate).toLocaleDateString()}</span>
            </div>
            <h1 class="mb-0 fs-2">{data.post.title}</h1>
            <p class="fs-6 mb-0 text-opacity-70">{data.post.excerpt}</p>
            <div class="d-flex align-items-center gap-3">
              <img src="/template/assets/images/testimonial/testimonial-1.jpg" alt="Author" class="img-fluid rounded-circle" width="50" height="50">
              <div>
                <h6 class="mb-0 fw-medium">{data.post.author}</h6>
                <p class="mb-0 text-opacity-70 small">Author</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Image -->
  <section class="blog-post-image py-4">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <img src={data.post.featuredImage} alt={data.post.title} class="img-fluid w-100 rounded-3 blog-featured-img" data-aos="fade-up" data-aos-delay="100" data-aos-duration="1000">
        </div>
      </div>
    </div>
  </section>

  <!-- Blog Post Content -->
  <section class="blog-post-content py-5 py-lg-11 py-xl-12">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="post-body" data-aos="fade-up" data-aos-delay="200" data-aos-duration="1000">
            <TinaMarkdown content={data.post.body} />
          </div>
          
          <!-- Tags -->
          {data.post.tags && data.post.tags.length > 0 && (
            <div class="mt-6" data-aos="fade-up" data-aos-delay="300" data-aos-duration="1000">
              <h6 class="mb-3">Tags:</h6>
              <div class="d-flex flex-wrap gap-2">
                {data.post.tags.map(tag => (
                  <span class="badge text-dark border">{tag}</span>
                ))}
              </div>
            </div>
          )}

          <!-- Author Bio -->
          <div class="mt-6 p-4 bg-dark text-white rounded-3" data-aos="fade-up" data-aos-delay="400" data-aos-duration="1000">
            <div class="d-flex align-items-center gap-4">
              <img src="/template/assets/images/testimonial/testimonial-1.jpg" alt="Author" class="img-fluid rounded-circle" width="60" height="60">
              <div>
                <h5 class="mb-1 text-white">{data.post.author}</h5>
                <p class="mb-0 text-white text-opacity-70">Author & Content Creator</p>
                <p class="mb-0 small text-white text-opacity-70">Passionate about creating valuable content and sharing insights with our community.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</MainLayout>

<style>
  .post-body {
    line-height: 1.8;
  }
  
  .post-body h1, .post-body h2, .post-body h3, .post-body h4, .post-body h5, .post-body h6 {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  
  .post-body p {
    margin-bottom: 1.5rem;
  }
  
  .post-body img {
    border-radius: 8px;
    margin: 2rem 0;
  }
  
  .post-body blockquote {
    border-left: 4px solid var(--bs-primary);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    background: rgba(var(--bs-primary-rgb), 0.05);
    padding: 1.5rem;
    border-radius: 0 8px 8px 0;
  }
  
  .blog-featured-img {
    max-height: 400px;
    object-fit: cover;
  }
  
  .blog-post-hero h1 {
    font-size: 2.5rem !important;
    line-height: 1.2;
  }
  
  @media (max-width: 768px) {
    .blog-post-hero h1 {
      font-size: 2rem !important;
    }
    
    .blog-featured-img {
      max-height: 250px;
    }
  }
</style>
