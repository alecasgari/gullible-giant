---
// Recent News Section Component
import { client } from '../../tina/__generated__/client';

// Fetch latest blog posts
const { data } = await client.queries.postConnection();
const posts = data.postConnection.edges.map(edge => edge.node);

// Sort by publish date and get latest 3 posts
const latestPosts = posts
  .sort((a, b) => new Date(b.publishDate || '').getTime() - new Date(a.publishDate || '').getTime())
  .slice(0, 3);
---

<!--  Recent news Section -->
<section class="Recent-news bg-light-gray py-5 py-lg-11 py-xl-12">
  <div class="container">
    <div class="d-flex flex-column gap-5 gap-xl-11">
      <div class="row gap-7 gap-xl-0">
        <div class="col-xl-4 col-xxl-4">
          <div class="d-flex align-items-center gap-7 py-2" data-aos="fade-right" data-aos-delay="100"
            data-aos-duration="1000">
            <span
              class="round-36 flex-shrink-0 text-dark rounded-circle bg-primary hstack justify-content-center fw-medium">09</span>
            <hr class="border-line bg-white">
            <span class="badge text-bg-dark">Resources</span>
          </div>
        </div>
        <div class="col-xl-8 col-xxl-7">
          <div class="row">
            <div class="col-xxl-8">
              <div class="d-flex flex-column gap-6" data-aos="fade-up" data-aos-delay="100"
                data-aos-duration="1000">
                <h2 class="mb-0">Recent news</h2>
                <p class="fs-5 mb-0 text-opacity-70">Explore the latest trends, bold projects, and creative insights
                  from our agencyâ€”shaping the future of branding, digital experiences, and storytelling.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        {latestPosts.map((post, index) => (
          <div class={`${index === 0 ? 'col-xl-6 mb-7 mb-xl-0' : 'col-md-6 col-xl-3 mb-7 mb-xl-0'}`}>
            <div class="resources d-flex flex-column gap-6" data-aos="fade-up" data-aos-delay={`${(index + 1) * 100}`}
              data-aos-duration="1000">
              <a href={`/blog/${post._sys.filename}`}
                class={`resources-img ${index === 0 ? 'resources-img-first' : ''} position-relative overflow-hidden d-block`}>
                <img src={post.featuredImage} alt={post.title} class="img-fluid">
              </a>
              <div class="resources-details">
                <p class="mb-0">{new Date(post.publishDate).toLocaleDateString()}</p>
                <h4 class="mb-0">{post.title}</h4>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>
